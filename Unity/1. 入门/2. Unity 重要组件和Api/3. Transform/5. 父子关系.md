# Unity Transformçˆ¶å­å…³ç³»è¯¦è§£

## ä¸€ã€çˆ¶å­å…³ç³»åŸºç¡€æ¦‚å¿µ

### 1.1 ä»€ä¹ˆæ˜¯çˆ¶å­å…³ç³»

**çˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰** æ˜¯Unityä¸­é€šè¿‡Transformç»„ä»¶å»ºç«‹çš„å¯¹è±¡å±‚çº§ç»“æ„ã€‚åœ¨è¿™ç§å…³ç³»ä¸­ï¼š
- **çˆ¶å¯¹è±¡ï¼ˆParentï¼‰**ï¼šåŒ…å«å…¶ä»–å¯¹è±¡çš„å®¹å™¨å¯¹è±¡
- **å­å¯¹è±¡ï¼ˆChildï¼‰**ï¼šè¢«åŒ…å«åœ¨çˆ¶å¯¹è±¡ä¸­çš„å¯¹è±¡
- **æ ¹å¯¹è±¡ï¼ˆRootï¼‰**ï¼šæ²¡æœ‰çˆ¶å¯¹è±¡çš„é¡¶å±‚å¯¹è±¡
- **å¶å­å¯¹è±¡ï¼ˆLeafï¼‰**ï¼šæ²¡æœ‰å­å¯¹è±¡çš„æœ«ç«¯å¯¹è±¡

> ğŸ’¡ **æ ¸å¿ƒç†è§£**ï¼š  
> çœŸæ­£ç»´æŒçˆ¶å­å…³ç³»çš„æ˜¯ **Transformç»„ä»¶**ï¼Œè€ŒéGameObjectæœ¬èº«ã€‚å½“çˆ¶å­å…³ç³»å½¢æˆåï¼Œ**æ§åˆ¶çˆ¶ç‰©ä½“æ—¶ï¼Œå­ç‰©ä½“ä¹Ÿä¼šå—åˆ°å½±å“**[ty-reference](1)ã€‚

---

### 1.2 å±‚çº§ç»“æ„ç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å•ä¸€çˆ¶çº§** | ä¸€ä¸ªå¯¹è±¡åªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶å¯¹è±¡ |
| **å¤šå­å¯¹è±¡** | ä¸€ä¸ªå¯¹è±¡å¯ä»¥æœ‰å¤šä¸ªå­å¯¹è±¡ |
| **æ ‘çŠ¶ç»“æ„** | æ•´ä¸ªåœºæ™¯å½¢æˆä»¥æ ¹å¯¹è±¡ä¸ºèµ·ç‚¹çš„æ ‘å½¢å±‚æ¬¡ |
| **å˜æ¢ç»§æ‰¿** | å­å¯¹è±¡ç»§æ‰¿çˆ¶å¯¹è±¡çš„ä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾å˜æ¢ |

```csharp
// å±‚çº§ç»“æ„ç¤ºä¾‹
// Root (æ ¹å¯¹è±¡)
// â”œâ”€â”€ ParentA
// â”‚   â”œâ”€â”€ Child1
// â”‚   â””â”€â”€ Child2
// â””â”€â”€ ParentB
//     â””â”€â”€ Child3
```

---

## äºŒã€çˆ¶å­å…³ç³»æ“ä½œæ–¹æ³•

### 2.1 å»ºç«‹çˆ¶å­å…³ç³»

#### ä»£ç æ–¹å¼å»ºç«‹
```csharp
public class HierarchyManager : MonoBehaviour 
{
    void CreateHierarchy()
    {
        // åˆ›å»ºçˆ¶å¯¹è±¡
        GameObject parent = new GameObject("Parent");
        
        // åˆ›å»ºå­å¯¹è±¡
        GameObject child1 = new GameObject("Child1");
        GameObject child2 = new GameObject("Child2");
        
        // å»ºç«‹çˆ¶å­å…³ç³»ï¼ˆæ–¹æ³•1ï¼‰
        child1.transform.SetParent(parent.transform);
        child2.transform.SetParent(parent.transform);
        
        // å»ºç«‹çˆ¶å­å…³ç³»ï¼ˆæ–¹æ³•2ï¼‰
        child1.transform.parent = parent.transform;
    }
}
```

#### SetParentå‚æ•°è¯¦è§£
`SetParent(Transform parent, bool worldPositionStays)`

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `parent` | ç›®æ ‡çˆ¶å¯¹è±¡çš„Transform | å¿…éœ€ |
| `worldPositionStays` | æ˜¯å¦ä¿æŒä¸–ç•Œåæ ‡ä¸å˜ | `true` |

```csharp
// ä¿æŒä¸–ç•Œåæ ‡ä¸å˜ï¼ˆæ¨èï¼‰
transform.SetParent(newParent, true);

// ç›´æ¥ä½¿ç”¨æœ¬åœ°åæ ‡ï¼ˆä¸ä¿æŒä¸–ç•Œä½ç½®ï¼‰
transform.SetParent(newParent, false);
```

> ğŸŒŸ **å…³é”®åŒºåˆ«**ï¼š
> - **worldPositionStays = true**ï¼šå­å¯¹è±¡çš„ä¸–ç•Œä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾ä¿æŒä¸å˜ï¼Œè‡ªåŠ¨è®¡ç®—æ–°çš„æœ¬åœ°åæ ‡
> - **worldPositionStays = false**ï¼šå­å¯¹è±¡çš„æœ¬åœ°åæ ‡ä¿æŒä¸å˜ï¼Œä¸–ç•Œåæ ‡ä¼šæ”¹å˜

---

### 2.2 è§£é™¤çˆ¶å­å…³ç³»

#### æ–­ç»å•ä¸ªçˆ¶å­å…³ç³»
```csharp
// æ–¹æ³•1ï¼šè®¾ç½®çˆ¶å¯¹è±¡ä¸ºnull
transform.parent = null;

// æ–¹æ³•2ï¼šä½¿ç”¨SetParent API
transform.SetParent(null);

// æ–¹æ³•3ï¼šä½¿ç”¨DetachChildrenï¼ˆæ–­ç»æ‰€æœ‰ç›´æ¥å­å¯¹è±¡ï¼‰
transform.DetachChildren(); // æ‰€æœ‰å­å¯¹è±¡å˜ä¸ºåœºæ™¯æ ¹èŠ‚ç‚¹
```

> âš ï¸ **æ³¨æ„**ï¼š`DetachChildren()` åªå½±å“**ç›´æ¥å­å¯¹è±¡**ï¼Œä¸å½±å“å­™å­å¯¹è±¡[ty-reference](9)ã€‚

---

### 2.3 æŸ¥è¯¢çˆ¶å­å…³ç³»

#### è·å–çˆ¶å¯¹è±¡ä¿¡æ¯
```csharp
// è·å–çˆ¶å¯¹è±¡çš„Transform
Transform parent = transform.parent;

// è·å–çˆ¶å¯¹è±¡çš„GameObject
GameObject parentObject = transform.parent.gameObject;

// è·å–æ ¹å¯¹è±¡ï¼ˆæœ€é¡¶å±‚çˆ¶å¯¹è±¡ï¼‰
Transform root = transform.root;

// æ£€æŸ¥æ˜¯å¦ä¸ºæ ¹å¯¹è±¡
bool isRoot = (transform.parent == null);
```

#### è·å–å­å¯¹è±¡ä¿¡æ¯
```csharp
// è·å–å­å¯¹è±¡æ•°é‡
int childCount = transform.childCount;

// æŒ‰åç§°æŸ¥æ‰¾å­å¯¹è±¡ï¼ˆå¯æ‰¾åˆ°å¤±æ´»å¯¹è±¡ï¼‰
Transform childByName = transform.Find("ChildName");

// æŒ‰ç´¢å¼•è·å–å­å¯¹è±¡
Transform firstChild = transform.GetChild(0);
Transform lastChild = transform.GetChild(transform.childCount - 1);

// éå†æ‰€æœ‰å­å¯¹è±¡
for (int i = 0; i < transform.childCount; i++)
{
    Transform child = transform.GetChild(i);
    Debug.Log($"å­å¯¹è±¡ {i}: {child.name}");
}
```

> ğŸ’¡ **é‡è¦æç¤º**ï¼š`transform.Find()` å¯ä»¥æ‰¾åˆ°**å¤±æ´»çš„å­å¯¹è±¡**ï¼Œè€Œ `GameObject.Find()` æ— æ³•æ‰¾åˆ°å¤±æ´»å¯¹è±¡[ty-reference](9)ã€‚

---

## ä¸‰ã€çˆ¶å­å…³ç³»çš„å½±å“æœºåˆ¶

### 3.1 å˜æ¢ç»§æ‰¿ï¼ˆTransform Inheritanceï¼‰

å­å¯¹è±¡çš„å˜æ¢å±æ€§åŸºäºçˆ¶å¯¹è±¡çš„åæ ‡ç³»è¿›è¡Œè®¡ç®—ï¼š

#### ä½ç½®ç»§æ‰¿
- **å­å¯¹è±¡ä¸–ç•Œä½ç½® = çˆ¶å¯¹è±¡ä¸–ç•Œä½ç½® + å­å¯¹è±¡æœ¬åœ°ä½ç½®**
- çˆ¶å¯¹è±¡ç§»åŠ¨æ—¶ï¼Œå­å¯¹è±¡åŒæ­¥è·Ÿéš

#### æ—‹è½¬ç»§æ‰¿
- **å­å¯¹è±¡ä¸–ç•Œæ—‹è½¬ = çˆ¶å¯¹è±¡ä¸–ç•Œæ—‹è½¬ Ã— å­å¯¹è±¡æœ¬åœ°æ—‹è½¬**
- çˆ¶å¯¹è±¡æ—‹è½¬æ—¶ï¼Œå­å¯¹è±¡ä»¥çˆ¶å¯¹è±¡ä¸ºè½´å¿ƒæ—‹è½¬

#### ç¼©æ”¾ç»§æ‰¿
- **å­å¯¹è±¡ä¸–ç•Œç¼©æ”¾ = çˆ¶å¯¹è±¡ä¸–ç•Œç¼©æ”¾ Ã— å­å¯¹è±¡æœ¬åœ°ç¼©æ”¾**
- çˆ¶å¯¹è±¡ç¼©æ”¾æ—¶ï¼Œå­å¯¹è±¡æŒ‰æ¯”ä¾‹ç¼©æ”¾

```csharp
// ç¤ºä¾‹ï¼šçˆ¶å­åæ ‡å…³ç³»
void ShowHierarchyRelationship()
{
    Debug.Log($"çˆ¶å¯¹è±¡ä¸–ç•Œä½ç½®: {transform.parent.position}");
    Debug.Log($"å­å¯¹è±¡æœ¬åœ°ä½ç½®: {transform.localPosition}");
    Debug.Log($"å­å¯¹è±¡ä¸–ç•Œä½ç½®: {transform.position}"); // è‡ªåŠ¨è®¡ç®—ç»“æœ
}
```

---

### 3.2 å…¶ä»–ç»§æ‰¿ç‰¹æ€§

#### æ¿€æ´»çŠ¶æ€ç»§æ‰¿
- **çˆ¶å¯¹è±¡ç¦ç”¨**ï¼š`SetActive(false)` æ—¶ï¼Œæ‰€æœ‰å­å¯¹è±¡è‡ªåŠ¨ç¦ç”¨
- **å­å¯¹è±¡å•ç‹¬ç¦ç”¨**ï¼šä¸å½±å“çˆ¶å¯¹è±¡æˆ–å…¶ä»–å­å¯¹è±¡

#### ç”Ÿå‘½å‘¨æœŸç»‘å®š
- **é”€æ¯çˆ¶å¯¹è±¡**ï¼šçˆ¶å¯¹è±¡é”€æ¯æ—¶ï¼Œæ‰€æœ‰å­å¯¹è±¡ä¸€åŒé”€æ¯
- **è§£é™¤çˆ¶å­å…³ç³»**ï¼šå­å¯¹è±¡ç‹¬ç«‹å­˜åœ¨ï¼Œä¸å†å—çˆ¶å¯¹è±¡å½±å“

#### ç‰©ç†ç³»ç»Ÿäº¤äº’
- **å•ä¸€åˆšä½“åŸåˆ™**ï¼šçˆ¶å¯¹è±¡çš„åˆšä½“æ§åˆ¶æ‰€æœ‰å­å¯¹è±¡ç¢°æ’ä½“çš„ç‰©ç†è¡Œä¸º
- **å­å¯¹è±¡ç‹¬ç«‹åˆšä½“**ï¼šéœ€è¦é€šè¿‡ç‰©ç†åŠ›æˆ–è¿åŠ¨å­¦æ§åˆ¶ç§»åŠ¨

---

## å››ã€å®ç”¨æ“ä½œæŠ€å·§

### 4.1 å­å¯¹è±¡é¡ºåºç®¡ç†

Unityä¸­å­å¯¹è±¡åœ¨Hierarchyé¢æ¿ä¸­æœ‰ç‰¹å®šçš„é¡ºåºï¼Œå¯ä»¥é€šè¿‡APIç®¡ç†ï¼š

```csharp
public Transform targetChild;

void ManageSiblingOrder()
{
    // è·å–è‡ªå·±ä½œä¸ºå­å¯¹è±¡çš„ç´¢å¼•
    int currentIndex = targetChild.GetSiblingIndex();
    Debug.Log($"å½“å‰ç´¢å¼•: {currentIndex}");
    
    // è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªå­å¯¹è±¡
    targetChild.SetAsFirstSibling();
    
    // è®¾ç½®ä¸ºæœ€åä¸€ä¸ªå­å¯¹è±¡
    targetChild.SetAsLastSibling();
    
    // è®¾ç½®ä¸ºæŒ‡å®šç´¢å¼•ä½ç½®
    targetChild.SetSiblingIndex(2); // ç´¢å¼•è¶Šç•Œä¼šè‡ªåŠ¨è®¾ä¸ºæœ€åä¸€ä¸ª
}
```

---

### 4.2 å…³ç³»åˆ¤æ–­

```csharp
// åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªå¯¹è±¡çš„å­å¯¹è±¡
bool isChild = transform.IsChildOf(parentTransform);

// åˆ¤æ–­çˆ¶å­å…³ç³»ç¤ºä¾‹
void CheckParentChildRelationship()
{
    if (childTransform.IsChildOf(parentTransform))
    {
        Debug.Log("childTransform æ˜¯ parentTransform çš„å­å¯¹è±¡");
    }
}
```

---

### 4.3 è·¨å±‚çº§ç»„ä»¶æŸ¥è¯¢

```csharp
// å‘ä¸ŠæŸ¥æ‰¾çˆ¶çº§ç»„ä»¶
Rigidbody parentRigidbody = GetComponentInParent<Rigidbody>();

// å‘ä¸‹æŸ¥æ‰¾å­çº§ç»„ä»¶
Collider[] childColliders = GetComponentsInChildren<Collider>();

// æŸ¥æ‰¾è‡ªèº«åŠæ‰€æœ‰å­å¯¹è±¡çš„ç»„ä»¶
Renderer[] allRenderers = GetComponentsInChildren<Renderer>(true); // trueåŒ…å«éæ¿€æ´»å¯¹è±¡
```

---

## äº”ã€å®ç”¨ç¤ºä¾‹

### 5.1 åŠ¨æ€å±‚çº§ç®¡ç†

```csharp
public class DynamicHierarchy : MonoBehaviour
{
    public Transform newParent;
    public Transform[] childrenToManage;
    
    void Start()
    {
        // å°†å½“å‰å¯¹è±¡è®¾ç½®ä¸ºæ–°çˆ¶å¯¹è±¡çš„å­å¯¹è±¡
        transform.SetParent(newParent, true);
        
        // æ‰¹é‡ç®¡ç†å­å¯¹è±¡
        foreach (Transform child in childrenToManage)
        {
            child.SetParent(transform, true);
        }
    }
    
    public void DetachAllChildren()
    {
        // æ–­ç»ä¸æ‰€æœ‰ç›´æ¥å­å¯¹è±¡çš„å…³ç³»
        transform.DetachChildren();
    }
}
```

---

### 5.2 çˆ¶å­å…³ç³»è°ƒè¯•å·¥å…·

```csharp
public class HierarchyDebugger : MonoBehaviour
{
    void OnGUI()
    {
        GUILayout.Label($"å¯¹è±¡åç§°: {gameObject.name}");
        GUILayout.Label($"æ˜¯å¦ä¸ºæ ¹å¯¹è±¡: {transform.parent == null}");
        GUILayout.Label($"å­å¯¹è±¡æ•°é‡: {transform.childCount}");
        
        if (transform.parent != null)
        {
            GUILayout.Label($"çˆ¶å¯¹è±¡: {transform.parent.name}");
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰å­å¯¹è±¡
        for (int i = 0; i < transform.childCount; i++)
        {
            Transform child = transform.GetChild(i);
            GUILayout.Label($"  å­å¯¹è±¡ {i}: {child.name}");
        }
    }
}
```

---

### 5.3 é¢„åˆ¶ä½“å±‚çº§ä¿ç•™

```csharp
// é¢„åˆ¶ä½“å®ä¾‹åŒ–æ—¶ï¼Œçˆ¶å­å±‚çº§å…³ç³»å®Œå…¨ä¿ç•™
public class PrefabHierarchyExample : MonoBehaviour
{
    public GameObject prefab;
    
    void InstantiateWithHierarchy()
    {
        // å®ä¾‹åŒ–é¢„åˆ¶ä½“ï¼Œä¿æŒåŸæœ‰å±‚çº§ç»“æ„
        GameObject instance = Instantiate(prefab, Vector3.zero, Quaternion.identity);
        
        // å¯ä»¥å®‰å…¨åœ°è®¿é—®å­å¯¹è±¡
        Transform weapon = instance.transform.Find("Weapon");
        if (weapon != null)
        {
            weapon.gameObject.SetActive(true);
        }
    }
}
```

---

## å…­ã€æœ€ä½³å®è·µä¸å¸¸è§é”™è¯¯

### 6.1 æ€§èƒ½è€ƒè™‘

| æ“ä½œ | æ€§èƒ½ | å»ºè®® |
|------|------|------|
| SetParent | ä¸­ | é¿å…é¢‘ç¹è°ƒç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨Updateä¸­ |
| Find | ä½ | ç¼“å­˜ç»“æœï¼Œé¿å…é‡å¤æŸ¥æ‰¾ |
| GetChild | é«˜ | é€‚åˆéå†æ“ä½œ |
| IsChildOf | ä¸­ | é€‚åˆå…³ç³»åˆ¤æ–­ |

> ğŸ’¡ **æœ€ä½³å®è·µ**ï¼š
> - **ç¼“å­˜Transformå¼•ç”¨**ï¼Œé¿å…é‡å¤è°ƒç”¨Find
> - **é¿å…åœ¨Updateä¸­é¢‘ç¹ä¿®æ”¹å±‚çº§å…³ç³»**
> - **ä½¿ç”¨GetComponentsInChildrenä¸€æ¬¡æ€§è·å–æ‰€æœ‰éœ€è¦çš„ç»„ä»¶**
> - **åˆç†è®¾è®¡å±‚çº§ç»“æ„**ï¼Œé¿å…è¿‡æ·±çš„åµŒå¥—

---

### 6.2 å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| çˆ¶å­å…³ç³»æ··ä¹± | é¢‘ç¹ä¿®æ”¹parentå¯¼è‡´åæ ‡å¼‚å¸¸ | ä½¿ç”¨SetParentçš„worldPositionStayså‚æ•° |
| Findæ‰¾ä¸åˆ°å¯¹è±¡ | å¯¹è±¡åç§°æ‹¼å†™é”™è¯¯æˆ–å¯¹è±¡å¤±æ´» | ç¡®è®¤åç§°æ­£ç¡®ï¼Œä½¿ç”¨Findå¯ä»¥æ‰¾åˆ°å¤±æ´»å¯¹è±¡ |
| ç´¢å¼•è¶Šç•Œ | GetChildç´¢å¼•è¶…å‡ºèŒƒå›´ | å…ˆæ£€æŸ¥childCountå†è®¿é—® |
| å¾ªç¯å¼•ç”¨ | å¯¹è±¡æˆä¸ºè‡ªå·±çš„çˆ¶å¯¹è±¡ | é¿å…å°†å¯¹è±¡è®¾ç½®ä¸ºè‡ªå·±çš„çˆ¶å¯¹è±¡ |
| ç‰©ç†å¼‚å¸¸ | çˆ¶å­å¯¹è±¡éƒ½æœ‰Rigidbody | éµå¾ªå•ä¸€åˆšä½“åŸåˆ™ |

---

### 6.3 è®¾è®¡å»ºè®®

1. **åˆç†åˆ†ç»„**ï¼šå°†ç›¸å…³çš„å¯¹è±¡ç»„ç»‡åœ¨åŒä¸€çˆ¶å¯¹è±¡ä¸‹
2. **å‘½åè§„èŒƒ**ï¼šä½¿ç”¨æ¸…æ™°çš„å‘½åä¾¿äºFindæ“ä½œ
3. **é¿å…è¿‡æ·±åµŒå¥—**ï¼šå±‚çº§æ·±åº¦æ§åˆ¶åœ¨3-5å±‚ä»¥å†…
4. **é¢„è®¾ç»“æ„**ï¼šåœ¨ç¼–è¾‘å™¨ä¸­é¢„å…ˆè®¾ç½®å¥½å±‚çº§å…³ç³»
5. **åŠ¨æ€ç®¡ç†**ï¼šè¿è¡Œæ—¶åªåœ¨å¿…è¦æ—¶ä¿®æ”¹å±‚çº§å…³ç³»

---

## ä¸ƒã€æ€»ç»“ï¼šçˆ¶å­å…³ç³»é»„é‡‘æ³•åˆ™

1. **å»ºç«‹å…³ç³»**ï¼šä½¿ç”¨ `SetParent(transform, true)` ä¿æŒä¸–ç•Œåæ ‡
2. **è§£é™¤å…³ç³»**ï¼šä½¿ç”¨ `parent = null` æˆ– `SetParent(null)`
3. **æŸ¥è¯¢æ“ä½œ**ï¼š`Find()` æ‰¾å­å¯¹è±¡ï¼Œ`parent` è·å–çˆ¶å¯¹è±¡
4. **éå†ç®¡ç†**ï¼š`childCount` + `GetChild(i)` å®‰å…¨éå†
5. **é¡ºåºæ§åˆ¶**ï¼šä½¿ç”¨ `SetAsFirstSibling()` ç­‰æ–¹æ³•ç®¡ç†é¡ºåº
6. **å…³ç³»åˆ¤æ–­**ï¼š`IsChildOf()` éªŒè¯çˆ¶å­å…³ç³»
7. **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜ Transform å¼•ç”¨ï¼Œé¿å…é‡å¤æŸ¥æ‰¾

> âœ¨ **ç»ˆææç¤º**ï¼š  
> "Transform çˆ¶å­å…³ç³»æ˜¯ Unity åœºæ™¯ç»„ç»‡çš„éª¨æ¶ï¼Œ  
> ç†è§£å˜æ¢ç»§æ‰¿ã€æŒæ¡å±‚çº§æ“ä½œï¼Œä½ å°±èƒ½æ„å»ºå‡º**æ¸…æ™°è€Œé«˜æ•ˆ**çš„å¯¹è±¡ç»“æ„ï¼›  
> ç”¨å¥½è¿™äº›æŠ€å·§ï¼Œä½ çš„æ¸¸æˆå°†æ‹¥æœ‰**çµæ´»è€Œç¨³å®š**çš„å±‚çº§ç®¡ç†ä½“ç³»ï¼"